<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'Modifica ' + ${recipe.title}">Modifica Ricetta</title>
    <link rel="stylesheet" th:href="@{/css/editRecipe.css}"/>
</head>
<body>

    <header>
        <a th:href="@{/admin/manageRecipes}" class="back-link">‚Üê Torna al Grimorio (Gestione)</a>
    </header>

    <main class="fairy-card">
        
        <h1 th:text="'Modifica: ' + ${recipe.title}">Modifica Ricetta</h1>

        <form th:action="@{'/admin/recipe/' + ${recipe.id} + '/update'}" th:object="${recipe}" method="post">
            
            <label>üìú Titolo Ricetta:</label>
            <input type="text" th:field="*{title}" />

            <label>‚ú® Descrizione:</label>
            <textarea th:field="*{description}" rows="3"></textarea>

            <label>üìñ Procedimento:</label>
            <textarea th:field="*{procedure}" rows="6"></textarea>

            <div class="grid-2-col">
                <div>
                    <label>‚è≥ Prep. (min):</label>
                    <input type="number" th:field="*{preparationTime}" />
                </div>
                <div>
                    <label>üî• Cottura (min):</label>
                    <input type="number" th:field="*{cookingTime}" />
                </div>
            </div>

            <div class="grid-2-col">
                <div>
                    <label>‚≠ê Difficolt√†:</label>
                    <input type="text" th:field="*{difficulty}" />
                </div>
                <div>
                    <label>üçΩÔ∏è Porzioni:</label>
                    <input type="number" th:field="*{servings}" />
                </div>
            </div>

            <label>üè∑Ô∏è Categoria:</label>
            <select th:field="*{category}">
                <option value="Antipasto">Antipasto</option>
                <option value="Primo">Primo</option>
                <option value="Secondo">Secondo</option>
                <option value="Dolce">Dolce</option>
                <option value="Altro">Altro</option>
            </select>

            <label>üè∑Ô∏è Tag (es. vegetariana...):</label>
            <input type="text" th:field="*{tags}" placeholder="Separati da virgola" />

            <label>üñºÔ∏è URL Immagine:</label>
            <input type="text" th:field="*{imageUrl}" placeholder="Inserisci l'URL dell'immagine..." />
            
            <button type="submit" class="save-btn">üíæ Salva modifiche</button>
        </form>

        <br><hr style="border-color: #C5A059; opacity: 0.5;"><br>

        <h2>Ingredienti</h2>
        <ul class="ingredients-list">
            <li th:each="ingredient : ${recipe.ingredients}" class="ingredient-item">
                <span>
                    <strong th:text="${ingredient.name}">Ingrediente</strong> 
                    <span th:if="${ingredient.quantity}"> - <span th:text="${ingredient.quantity}">Qt</span></span>
                    <span th:if="${ingredient.unit}" th:text="${ingredient.unit}">Unit√†</span>
                </span>
                
                <form th:action="@{'/admin/recipe/' + ${recipe.id} + '/ingredient/' + ${ingredient.id} + '/remove'}"
                      method="post" style="display:inline; margin:0;">
                    <button type="submit" class="remove-btn">‚ùå Rimuovi</button>
                </form>
            </li>
        </ul>

        <h3>Aggiungi nuovo ingrediente</h3>
        <div class="add-ingredient-box">
            <form th:action="@{'/admin/recipe/' + ${recipe.id} + '/ingredient/add'}" th:object="${ingredient}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                
                <label>Nome:</label>
                <input type="text" th:field="*{name}" required placeholder="Es. Farina Magica"/>
                
                <div class="grid-2-col">
                    <div>
                        <label>Quantit√†:</label>
                        <input type="text" th:field="*{quantity}" />
                    </div>
                    <div>
                        <label>Unit√†:</label>
                        <input type="text" th:field="*{unit}" placeholder="es. g, ml" />
                    </div>
                </div>
                
                <button type="submit" class="add-btn">‚ûï Aggiungi Ingrediente</button>
            </form>
        </div>

    </main>

</body>
</html>