<!DOCTYPE html>
			<html xmlns:th="http://www.thymeleaf.org">

			<head>
			    <meta charset="UTF-8">
			    <title>Nuova Ricetta</title>
			    <link rel="stylesheet" href="/css/formNewRecipes.css" /> 
			</head>

			<body>
			    <header>
			        <a href="/recipes">‚Üê Torna alle ricette</a>
			    </header>

			    <main>
			        <h1>Aggiungi una nuova ricetta</h1>

			        <form th:action="@{/admin/formNewRecipe}" th:object="${recipe}" method="POST">
			            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

			            <div th:if="${#fields.hasGlobalErrors()}">
			                <p th:each="err : ${#fields.globalErrors()}" th:text="${err}" style="color: red;"></p>
			            </div>

			            <fieldset>
			                <legend>Informazioni Base e Istruzioni</legend>

			                <div>
			                    <label for="title-input">Titolo:</label>
			                    <input id="title-input" type="text" th:field="*{title}" required/>
			                    <span style="color: red;" th:if="${#fields.hasErrors('title')}" th:errors="*{title}"></span>
			                </div>

			                <div>
			                    <label for="description-input">Descrizione Breve:</label>
			                    <textarea id="description-input" th:field="*{description}" rows="3" required></textarea>
			                </div>

			                <div>
			                    <label for="procedure-input">Procedimento Completo:</label>
			                    <textarea id="procedure-input" th:field="*{procedure}" rows="8" required></textarea>
			                </div>
			            </fieldset>

			            <fieldset>
			                <legend>Dettagli Tecnici e Extra</legend>

			                <div>
			                    <label for="preparationTime-input">Tempo (minuti):</label>
			                    <input id="preparationTime-input" type="number" th:field="*{preparationTime}" min="1" required/>
			                    <label for="servings-input">Porzioni:</label>
			                    <input id="servings-input" type="number" th:field="*{servings}" min="1" required/>
			                    <label for="difficulty-input">Difficolt√†:</label>
			                    <input id="difficulty-input" type="text" th:field="*{difficulty}" placeholder="Es. Facile" required/>
			                </div>

			                <div>
			                    <label for="category-select">Categoria:</label>
			                    <select id="category-select" th:field="*{category}">
			                        <option value="Antipasto">Antipasto</option>
			                        <option value="Primo">Primo</option>
			                        <option value="Secondo">Secondo</option>
			                        <option value="Dolce">Dolce</option>
			                        <option value="Altro">Altro</option>
			                    </select>
			                </div>

			                <div>
			                    <label for="imageUrl-input">URL Immagine (opzionale):</label>
			                    <input id="imageUrl-input" type="text" th:field="*{imageUrl}" placeholder="http://..." />
			                </div>

			                <div>
			                    <label>Tag:</label><br>
			                    <input type="checkbox" th:value="'Vegetariano'" th:field="*{tags}"> Vegetariano
			                    <input type="checkbox" th:value="'Vegano'" th:field="*{tags}"> Vegano
			                    <input type="checkbox" th:value="'Senza Glutine'" th:field="*{tags}"> Senza Glutine
			                    <input type="checkbox" th:value="'Senza Lattosio'" th:field="*{tags}"> Senza Lattosio
			                </div>
			            </fieldset>

			            <fieldset>
			                <legend>Ingredienti</legend>
			                
			                <div id="ingredients-container">
			                    </div>

			                <button type="button" onclick="addIngredientField()">‚ûï Aggiungi Ingrediente</button>
			                <p style="color: grey; font-size: small; margin-top: 5px;">*Solo gli ingredienti con il Nome compilato verranno salvati.</p>
			            </fieldset>

			           
			    
			<script>
			/*<![CDATA[*/
			    var ingredientIndex = 0; 

			    function addIngredientField() {
			        var container = document.getElementById('ingredients-container');
			        var index = ingredientIndex++; 
			        
			        // Il template HTML per un singolo blocco ingrediente
			        var template = 
			            '<div class="ingredient-block" id="ing-block-' + index + '">' +
			                '<h4 style="margin-top: 10px;">Nuovo Ingrediente</h4>' + 
			                // Nomi cruciali per la mappatura a collezione di Spring: ingredients[X].name
			                '<label>Nome:</label><input type="text" name="ingredients[' + index + '].name" required/>' +
			                '<label>Quantit√†:</label><input type="text" name="ingredients[' + index + '].quantity" placeholder="Es. 100" />' +
			                '<label>Unit√†:</label><input type="text" name="ingredients[' + index + '].unit" placeholder="Es. grammi" />' +
			                '<button type="button" onclick="removeIngredientField(' + index + ')" style="margin-top: 5px;">Rimuovi</button>' +
			                '<hr style="margin: 10px 0;"/>' +
			            '</div>';

			        container.insertAdjacentHTML('beforeend', template);
			    }

			    function removeIngredientField(index) {
			        var element = document.getElementById('ing-block-' + index);
			        if (element) {
			            element.remove();
			        }
			    }
			    
			    // Aggiunge il primo campo di default all'apertura
			    window.onload = function() {
			        addIngredientField(); 
			    };
			/*]]>*/
			</script>
			</body>
			</html>
				
            <div>
                <button type="submit">üíæ Conferma Aggiunta Ricetta</button>
            </div>
            
        </form>
    </main>
</body>
</html>
