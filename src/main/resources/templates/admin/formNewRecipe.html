<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>AGGIUNGI RICETTA </title>
    <link rel="stylesheet" href="/css/formNewRecipe.css" /> 
</head>
<body>
    <header class="page-header-link">
        <a href="/recipes">← Torna alle ricette</a>
    </header>

    <header style="display:none;"></header>

    <main>
        <h1>Aggiungi una nuova ricetta </h1>

        <form th:action="@{/admin/formNewRecipe}" th:object="${recipe}" method="POST" class="parchment-form">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <div th:if="${#fields.hasGlobalErrors()}" class="global-errors">
                <p th:each="err : ${#fields.globalErrors()}" th:text="${err}" style="color: red;"></p>
            </div>

            <fieldset class="details-section">
                <legend>DETTAGLI PRINCIPALI</legend>

                <div class="field-row">
                    <label for="title-input">Nome Ricetta</label>
                    <input id="title-input" type="text" th:field="*{title}" required/>
                    <span style="color: red;" th:if="${#fields.hasErrors('title')}" th:errors="*{title}"></span>
                </div>

                <div class="field-row">
                    <label for="description-input">Descrizione Breve</label>
                    <textarea id="description-input" th:field="*{description}" rows="2" required></textarea>
                </div>
                
                <div class="inline-metadata-group">
                    
                    <div class="inline-field category-field">
                        <label for="category-select">Categoria</label>
                        <select id="category-select" th:field="*{category}">
                            <option value="Antipasto">Antipasto</option>
                            <option value="Primo">Primo</option>
                            <option value="Secondo">Secondo</option>
                            <option value="Dolce">Dolce</option>
                            <option value="Altro">Altro</option>
                        </select>
                    </div>

                    <div class="inline-field half-field">
                        <label for="preparationTime-input">Tempo di Preparazione (min)</label>
                        <input id="preparationTime-input" type="number" th:field="*{preparationTime}" min="1" required/>
                    </div>
                    
                    <div class="inline-field half-field">
                        <label for="cookingTime-input">Tempo di Cottura (min)</label> 
                        <input id="cookingTime-input" type="number" th:field="*{servings}" min="1" required/>
                    </div>
                </div>

                <div class="inline-metadata-group">
                    <div class="inline-field half-field">
                        <label for="difficulty-input">Difficoltà</label>
                        <input id="difficulty-input" type="text" th:field="*{difficulty}" placeholder="Es. Facile" required/>
                    </div>
                    <div class="inline-field half-field">
                        <label for="imageUrl-input">URL Immagine (opzionale)</label>
                        <input id="imageUrl-input" type="text" th:field="*{imageUrl}" placeholder="http://..." />
                    </div>
                </div>

                <div class="field-row">
                    <label for="procedure-input">Procedimento Completo</label>
                    <textarea id="procedure-input" th:field="*{procedure}" rows="8" required></textarea>
                </div>
            </fieldset>

			<fieldset>
			<div>
					                    <label>Tag:</label><br>
					                    <input type="checkbox" th:value="'Vegetariano'" th:field="*{tags}"> Vegetariano
					                    <input type="checkbox" th:value="'Vegano'" th:field="*{tags}"> Vegano
					                    <input type="checkbox" th:value="'Senza Glutine'" th:field="*{tags}"> Senza Glutine
					                    <input type="checkbox" th:value="'Senza Lattosio'" th:field="*{tags}"> Senza Lattosio
					                </div>
					            </fieldset>              
									
									
            <fieldset class="ingredients-section">
                <legend> INGREDIENTI </legend>
                
                <div id="ingredients-container"></div>
                
                <div class="ingredient-actions-bottom">
                    <button type="button" onclick="addIngredientField()" class="add-ingredient-button">
                        <span class="icon-plus">+</span> Aggiungi Ingrediente
                    </button>
                    <p class="ingredient-note">
                        *Solo gli ingredienti con il Nome compilato verranno salvati.
                    </p>
                </div>
            </fieldset>
            
			<div class="submit-container">
			                <button type="submit" class="btn-golden-oval">CONFERMA</button>
			                <div class="submit-links">
               
                    <a href="#">Salva come bozza</a> | 
                    <a href="#">Annulla</a>
                </div>
            </div>
            
        </form>
    </main>
    
    <script>
    /*<![CDATA[*/
        var ingredientIndex = 0; 

        function addIngredientField() {
            var container = document.getElementById('ingredients-container');
            // Usiamo il contatore per assicurare che gli indici siano corretti
            var index = ingredientIndex++; 
            
            // Template Orizzontale per Nome/Quantità/Unità + Pulsante Rimuovi
            var template = 
                '<div class="ingredient-block" id="ing-block-' + index + '">' +
                    '<div class="ingredient-fields-row">' +
                        
                        // Campo 1: Nome (Ingrediente principale) - usa la classe CSS ing-name-full
                        '<div class="ing-field ing-name-full">' + 
                            '<label for="ing-name-' + index + '">Ingrediente:</label>' +
                            '<input id="ing-name-' + index + '" type="text" name="ingredients[' + index + '].name" placeholder="Es. Farina, Uova..." required/>' +
                        '</div>' +
                        
                        // Campo 2: Quantità - usa la classe CSS ing-quantity
                        '<div class="ing-field ing-quantity">' +
                            '<label for="ing-qty-' + index + '">Quantità:</label>' +
                            '<input id="ing-qty-' + index + '" type="text" name="ingredients[' + index + '].quantity" placeholder="Es. 100" />' +
                        '</div>' +
                        
                        // Campo 3: Unità - usa la classe CSS ing-unit
                        '<div class="ing-field ing-unit">' +
                            '<label for="ing-unit-' + index + '">Unità:</label>' +
                            '<input id="ing-unit-' + index + '" type="text" name="ingredients[' + index + '].unit" placeholder="Es. g, ml, pezzi" />' +
                        '</div>' +
                        
                        // Pulsante Rimuovi - usa la classe CSS remove-button inline-button
                        '<button type="button" onclick="removeIngredientField(' + index + ')" class="remove-button inline-button">' +
                            'Rimuovi' + 
                        '</button>' +
                    '</div>' +
                '</div>';

            container.insertAdjacentHTML('beforeend', template);
        }

        function removeIngredientField(index) {
            var element = document.getElementById('ing-block-' + index);
            if (element) {
                element.remove();
            }
        }
        
        window.onload = function() {
            // Aggiunge una riga all'inizio per default
            addIngredientField(); 
        };
    /*]]>*/
    </script>
</body>
</html>